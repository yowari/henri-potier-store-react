(this["webpackJsonphenri-potier-store-react"]=this["webpackJsonphenri-potier-store-react"]||[]).push([[0],{28:function(e,t,c){},29:function(e,t,c){},37:function(e,t,c){"use strict";c.r(t);var n=c(1),r=c.n(n),a=c(22),s=c.n(a),i=(c(28),c(11)),o=(c(29),c(7)),l=c(9),d=c(8),j=function(e){return e.items.reduce((function(e,t){return e+t.quantity}),0)};function b(e,t){switch(t.type){case"[Books Search Page] Add to Cart":var c=e.items.findIndex((function(e){return e.book.isbn===t.payload.isbn}));return c>=0?Object(d.a)(Object(d.a)({},e),{},{items:[].concat(Object(l.a)(e.items.slice(0,c)),[{book:t.payload,quantity:e.items[c].quantity+1}],Object(l.a)(e.items.slice(c+1)))}):Object(d.a)(Object(d.a)({},e),{},{items:[].concat(Object(l.a)(e.items),[{book:t.payload,quantity:1}])});case"[Books Search Page] Remove from Cart":var n=e.items.findIndex((function(e){return e.book.isbn===t.payload.isbn}));return n>=0?e.items[n].quantity-1===0?Object(d.a)(Object(d.a)({},e),{},{items:[].concat(Object(l.a)(e.items.slice(0,n)),Object(l.a)(e.items.slice(n+1)))}):Object(d.a)(Object(d.a)({},e),{},{items:[].concat(Object(l.a)(e.items.slice(0,n)),[{book:t.payload,quantity:e.items[n].quantity-1}],Object(l.a)(e.items.slice(n+1)))}):e}return e}var u={shoppingCart:{items:[]}};function h(e,t){return{shoppingCart:b(e.shoppingCart,t)}}var m=c(0),f=Object(n.createContext)(u),O=Object(n.createContext)(null);function x(){return Object(n.useContext)(f)}function p(e){var t=e.children,c=Object(n.useReducer)(h,u),r=Object(o.a)(c,2),a=r[0],s=r[1];return Object(m.jsx)(f.Provider,{value:a,children:Object(m.jsx)(O.Provider,{value:s,children:t})})}var v=c(2);function g(e){var t=e.itemsCount;return Object(m.jsx)("header",{className:"navbar navbar-light bg-white sticky-top border-bottom",children:Object(m.jsxs)("div",{className:"container-fluid",children:[Object(m.jsx)(i.b,{className:"navbar-brand",to:"/",children:"Henri Potier Store"}),Object(m.jsxs)(i.b,{className:"btn btn-outline-primary",to:"/shopping-cart","data-cy":"cartButton",children:[t>0&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("span",{className:"badge rounded-pill bg-primary","data-testid":"itemsCount",children:t})," "]}),"Panier"]})]})})}var y=c(12),C=c.n(y),N=c(16);function k(e){return Object(m.jsx)("div",{className:"d-grid",children:e.quantity>0?Object(m.jsxs)("div",{className:"row g-0 bg-light border rounded",children:[Object(m.jsx)("button",{className:"btn btn-primary col-3",onClick:e.removeFromCart,"data-cy":"removeFromCart",children:"-"}),Object(m.jsx)("div",{className:"col text-center d-flex flex-column justify-content-center align-items-center",children:Object(m.jsx)("div",{children:e.quantity})}),Object(m.jsx)("button",{className:"btn btn-primary col-3",onClick:e.addToCart,"data-cy":"addToCart",children:"+"})]}):Object(m.jsx)("button",{className:"btn btn-primary",onClick:e.addToCart,"data-cy":"addToCart",children:"Ajouter au Panier"})})}function w(e){var t=e.book,c=e.quantity,n=e.removeFromCart,r=e.addToCart;return Object(m.jsx)("article",{className:"book-item card my-4",children:Object(m.jsxs)("div",{className:"row g-0",children:[Object(m.jsx)("div",{className:"book-item__cover book-cover col-md-2 text-center",children:Object(m.jsx)("img",{src:t.cover,className:"book-cover__image img-fluid p-2",alt:t.title})}),Object(m.jsxs)("div",{className:"book-item__info book-info card-body col-md-8",children:[Object(m.jsx)("h5",{className:"book-info__title card-title",children:t.title}),Object(m.jsx)("div",{className:"book-info__summary overflow-auto",children:t.synopsis.map((function(e,t){return Object(m.jsx)("p",{className:"card-text",children:e},t)}))})]}),Object(m.jsxs)("div",{className:"book-item__action book-action col-md-2 border-start p-3",children:[Object(m.jsxs)("div",{className:"book-action__price mb-4 fs-5",children:["prix: ",Object(m.jsxs)("strong",{children:[t.price,"\u20ac"]})]}),Object(m.jsx)("div",{className:"book-action__add",children:Object(m.jsx)(k,{quantity:c,removeFromCart:function(){n(t)},addToCart:function(){r(t)}})})]})]})})}function F(){var e=x(),t=Object(n.useContext)(O),c=Object(n.useState)([]),r=Object(o.a)(c,2),a=r[0],s=r[1],i=Object(n.useState)(!1),l=Object(o.a)(i,2),d=l[0],j=l[1],b=Object(n.useState)(""),u=Object(o.a)(b,2),h=u[0],f=u[1],p=Object(n.useState)([]),v=Object(o.a)(p,2),g=v[0],y=v[1];Object(n.useEffect)((function(){(function(){var e=Object(N.a)(C.a.mark((function e(){var t;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return j(!0),e.next=3,fetch("".concat("https://henri-potier.techx.fr","/books")).then((function(e){return e.json()}));case 3:t=e.sent,s(t),j(!1);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(n.useEffect)((function(){var e=function(e,t){var c=t.toLocaleLowerCase();return e.filter((function(e){return e.title.toLocaleLowerCase().includes(c)||e.synopsis.some((function(e){return e.toLocaleLowerCase().includes(c)}))}))}(a,h);y(e)}),[a,h]);var k=function(e){t({type:"[Books Search Page] Remove from Cart",payload:e})},F=function(e){t({type:"[Books Search Page] Add to Cart",payload:e})};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)("div",{className:"my-4",children:Object(m.jsx)("input",{className:"form-control",type:"search",placeholder:"Rechercher un livre...","aria-label":"Rechercher un livre",name:"searchText",value:h,onChange:function(e){f(e.target.value)},"data-cy":"searchText"})}),d?Object(m.jsx)("div",{className:"text-center",children:Object(m.jsx)("div",{className:"spinner-border",role:"status",children:Object(m.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):g.map((function(t,c){return Object(m.jsx)(w,{book:t,removeFromCart:k,addToCart:F,quantity:(n=t.isbn,function(e){var t=e.items.find((function(e){return e.book.isbn===n}));return t?t.quantity:0})(e.shoppingCart)},c);var n}))]})}function q(e,t){for(var c=t.map((function(t){return function(e,t){switch(t.type){case"minus":return t.value;case"percentage":return e*(t.value/100);case"slice":return Math.floor(e/t.sliceValue)*t.value;default:throw new Error("Unrecognized offer type")}}(e,t)})),n=0,r=0;r<c.length;r++)c[r]>c[n]&&(n=r);return{offer:t[n],discount:c[n]}}function _(e){var t=e.items,c=e.total,n=e.bestOffer,r=function(e,t){return t&&e?e-t.discount:e}(c,n);return Object(m.jsxs)("table",{className:"table",children:[Object(m.jsx)("tbody",{children:t.map((function(e,t){return Object(m.jsxs)("tr",{"data-cy":"shoppingCartItem",children:[Object(m.jsx)("td",{children:e.book.title}),Object(m.jsxs)("td",{className:"text-end",children:[e.quantity," x ",e.book.price,"\u20ac"]})]},t)}))}),Object(m.jsxs)("tfoot",{children:[n&&Object(m.jsxs)("tr",{className:"text-danger",children:[Object(m.jsx)("td",{children:Object(m.jsx)(S,{bestOffer:n})}),Object(m.jsxs)("td",{className:"text-end",children:["-",n.discount,"\u20ac"]})]}),Object(m.jsxs)("tr",{children:[Object(m.jsx)("td",{children:"Total"}),Object(m.jsxs)("td",{className:"text-end",children:[n&&Object(m.jsxs)(m.Fragment,{children:[Object(m.jsxs)("span",{className:"text-decoration-line-through",children:[c,"\u20ac"]}),"\xa0"]}),Object(m.jsxs)("span",{children:[r,"\u20ac"]})]})]})]})]})}function S(e){var t=e.bestOffer;switch(t.offer.type){case"percentage":return Object(m.jsxs)(m.Fragment,{children:["Offre -",t.offer.value/100,"\u20ac"]});case"minus":return Object(m.jsxs)(m.Fragment,{children:["Offre -",t.offer.value,"\u20ac"]});case"slice":return Object(m.jsxs)(m.Fragment,{children:["Offre -",t.offer.value," chaque ",t.offer.sliceValue,"\u20ac"]});default:return Object(m.jsx)(m.Fragment,{children:"Incorrect offer"})}}function P(){var e=x(),t=Object(n.useState)(),c=Object(o.a)(t,2),r=c[0],a=c[1],s=Object(n.useState)(!1),i=Object(o.a)(s,2),l=i[0],d=i[1],b=e.shoppingCart.items,u=j(e.shoppingCart),h=e.shoppingCart.items.reduce((function(e,t){return e+t.quantity*t.book.price}),0);return Object(n.useEffect)((function(){(function(){var e=Object(N.a)(C.a.mark((function e(){var t,c;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d(!0),!(b.length>0)){e.next=6;break}return e.next=4,n=b.map((function(e){return e.book.isbn})),fetch("".concat("https://henri-potier.techx.fr","/books/").concat(n.join(","),"/commercialOffers")).then((function(e){return e.json()}));case 4:(t=e.sent).offers.length>0?(c=q(h,t.offers),a(c)):a(void 0);case 6:d(!1);case 7:case"end":return e.stop()}var n}),e)})));return function(){return e.apply(this,arguments)}})()()}),[b,h]),Object(m.jsx)("div",{className:"row my-4",children:Object(m.jsx)("div",{className:"card col-md-8",children:Object(m.jsxs)("div",{className:"card-body",children:[Object(m.jsxs)("h4",{className:"card-title",children:["Panier (",u," Livres)"]}),l?Object(m.jsx)("div",{className:"text-center",children:Object(m.jsx)("div",{className:"spinner-border",role:"status",children:Object(m.jsx)("span",{className:"visually-hidden",children:"Loading..."})})}):b.length>0?Object(m.jsx)(_,{items:b,total:h,bestOffer:r}):"Votre panier est vide"]})})})}function T(){var e=x();return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(g,{itemsCount:j(e.shoppingCart)}),Object(m.jsx)("main",{className:"container",children:Object(m.jsxs)(v.c,{children:[Object(m.jsx)(v.a,{exact:!0,path:"/",children:Object(m.jsx)(F,{})}),Object(m.jsx)(v.a,{path:"/shopping-cart",children:Object(m.jsx)(P,{})})]})})]})}var L=function(){return Object(m.jsx)(i.a,{basename:"/henri-potier-store-react",children:Object(m.jsx)(p,{children:Object(m.jsx)(T,{})})})},B=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,38)).then((function(t){var c=t.getCLS,n=t.getFID,r=t.getFCP,a=t.getLCP,s=t.getTTFB;c(e),n(e),r(e),a(e),s(e)}))};s.a.render(Object(m.jsx)(r.a.StrictMode,{children:Object(m.jsx)(L,{})}),document.getElementById("root")),B()}},[[37,1,2]]]);
//# sourceMappingURL=main.422c62f6.chunk.js.map